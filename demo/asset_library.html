<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booth Asset Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="web_data/style.css" />
    <style>
        #appLoader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b0b0d; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.6s ease; }
        .spinner { width: 50px; height: 50px; border: 3px solid rgba(253, 218, 13, 0.1); border-radius: 50%; border-top-color: #FDDA0D; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #mainWrapper { opacity: 0; transition: opacity 0.8s ease; visibility: hidden; }
        body.loaded #mainWrapper { opacity: 1; visibility: visible; }
        body.loaded #appLoader { opacity: 0; pointer-events: none; }
        .asset-link-view-all { display: flex; align-items: center; justify-content: center; background: rgba(253, 218, 13, 0.05); border: 1px dashed #FDDA0D; border-radius: 6px; text-decoration: none; transition: 0.2s; padding: 8px; height: 46px; box-sizing: border-box; }
        .asset-link-view-all:hover { background: rgba(253, 218, 13, 0.15); transform: translateY(-2px); }
        .asset-link-view-all span { color: #FDDA0D; font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }
        .asset-link-grid { align-items: stretch; }
        .asset .stats { display: flex; flex-wrap: wrap; gap: 4px 8px; height: auto; min-height: 1.2rem; }
        .asset .stats span { white-space: nowrap; }
    </style>
</head>
<body>
    <div id="appLoader"><div class="spinner"></div></div>
    <div id="mainWrapper">
        <div id="menuPerimeter" onclick="toggleMenu(event, true)"></div>
        <nav class="top-nav">
            <div class="nav-logo" data-i18n="navTitle">Booth Asset Library</div>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="..." onkeyup="handleSearchInput()">
                <button id="clearSearch" class="clear-search" onclick="clearSearch()">Ã—</button>
            </div>
            <button id="toggleBtn" class="nav-btn" onclick="toggleMenu(event)" data-i18n="optionsBtn">Options âš™</button>
        </nav>
        <div id="flyoutMenu" class="flyout-menu">
            <div class="setting-group"><span class="setting-label" data-i18n="labelLanguage">Language</span>
                <select id="langSelect" onchange="updateLanguage(this.value)"></select>
            </div>
            <div class="setting-group"><span class="setting-label" data-i18n="labelType">Item Type</span>
                <select id="typeFilter" onchange="applyFilters(true)">
                    <option value="all" data-i18n="optTypeAll">All Items</option><option value="avatar" data-i18n="optTypeAvatar">Avatars</option><option value="asset" data-i18n="optTypeAsset">Assets</option>
                </select>
            </div>
            <div class="setting-group"><span class="setting-label" data-i18n="labelSort">Sort Order</span>
                <select id="sortOrder" onchange="sortAssets(true)">
                    <option value="id" data-i18n="optId">Folder ID</option><option value="new" data-i18n="optNew">Recently Added</option><option value="name" data-i18n="optName">Alphabetical</option><option value="rel" data-i18n="optRel">Relevance</option><option value="size" data-i18n="optSize">Total Size</option>
                </select>
            </div>
            <div class="setting-group"><span class="setting-label" data-i18n="labelAdult">Adult Filter</span>
                <select id="adultFilter" onchange="applyFilters(true)">
                    <option value="all" data-i18n="optAll">Show All</option><option value="hide" data-i18n="optHide">Hide Adult</option><option value="only" data-i18n="optOnly">Only Adult</option>
                </select>
            </div>
            <div class="setting-group"><span class="setting-label" data-i18n="labelWidth">Card Width</span><input type="range" id="gridRange" min="160" max="400" step="10" value="220" oninput="updateGrid(this.value)"></div>
            <div class="setting-group">
                <label style="display:flex; gap:10px; cursor:pointer; font-size:0.9rem; margin-bottom:10px;"><input type="checkbox" id="blurToggle" onchange="updateBlur(this.checked)"> <span data-i18n="optBlur">Disable Blur</span></label>
                <label style="display:flex; gap:10px; cursor:pointer; font-size:0.9rem; margin-bottom:10px;"><input type="checkbox" id="hideIdToggle" onchange="updateIdVisibility(this.checked)"> <span data-i18n="optHideIds">Hide IDs</span></label>
                <label style="display:flex; gap:10px; cursor:pointer; font-size:0.9rem;"><input type="checkbox" id="translateToggle" onchange="updateTranslationVisibility(this.checked)"> <span data-i18n="optTranslate">English Titles</span></label>
            </div>
            <div class="stats-footer">
                <div class="stat-row"><span data-i18n="statItems">Items</span>: <b id="statCount">0</b></div>
                <div class="stat-row"><span data-i18n="statSize">Binary Size</span>: <b id="statSize">0B</b></div>
                <div class="stat-row"><span data-i18n="statImgSize">Asset Graphics</span>: <b id="statImgSize">0B</b></div>
                <div class="stat-row"><span data-i18n="statSpent">Estimated Investment</span>: <b id="statSpent">0</b></div>
                <div class="stat-row"><span data-i18n="statUpdated">Last Updated</span>: <b id="statDate">N/A</b></div>
                <span class="setting-label" style="margin-top:10px;" data-i18n="labelTopTags">Top Tags</span>
                <div id="commonTags" class="common-tags-grid"></div>
            </div>
        </div>
        <div class="container"><ul id="assetList"></ul><div id="filterNotice"></div></div>
    </div>
    <div id="detailModal" class="modal" onclick="closeModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="modal-carousel" id="modalCarouselContainer">
                <button id="carouselPrev" class="carousel-btn btn-prev" onclick="carouselNext(-1)">â®</button>
                <img id="modalBlurBg" class="carousel-blur-bg" src="">
                <img id="modalImg" class="carousel-main-img" src="">
                <button id="carouselNext" class="carousel-btn btn-next" onclick="carouselNext(1)">â¯</button>
                <div id="carouselDots" class="carousel-dots"></div>
            </div>
            <div class="modal-info">
                <div class="modal-header-fixed">
                    <div id="modalName" class="modal-name"></div>
                    <div id="modalSubtitle" class="modal-subtitle"></div>
                    <div id="delistedWarn" class="delisted-warning" data-i18n-html="warnDelisted"></div>
                </div>
                <div class="modal-tabs">
                    <button id="tab-details" class="tab-btn active" onclick="switchTab('details')" data-i18n="btnDetails">Details</button>
                    <button id="tab-files" class="tab-btn" onclick="switchTab('files')" data-i18n="labelBinary">Files</button>
                    <button id="tab-description" class="tab-btn" onclick="switchTab('description')" data-i18n="btnDesc">Description</button>
                </div>
                <div class="tab-content-container">
                    <div id="pane-details" class="tab-pane active">
                        <span class="modal-section-title">Pricing & Meta</span>
                        <div class="modal-meta-row" id="modalMeta"></div>
                        <span class="modal-section-title" style="margin-top:20px;">Tags</span>
                        <div id="modalTags" style="display:flex; flex-wrap:wrap; gap:6px;"></div>
                        <div id="relSection" style="display:none; margin-top:20px;">
                            <span class="modal-section-title" id="relTitle">Relationships</span>
                            <div id="relationshipContainer" class="asset-link-grid"></div>
                        </div>
                    </div>
                    <div id="pane-files" class="tab-pane">
                        <span class="modal-section-title">Package Contents</span>
                        <ul id="fileList" class="file-list"></ul>
                    </div>
                    <div id="pane-description" class="tab-pane">
                        <div id="modalDesc" class="desc-content"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="modalIdDisp" class="modal-id-display"></div>
                    <div class="modal-actions">
                        <a id="openVrcAvatarLink" href="" class="discrete-link" target="_blank" style="display:none;"><span data-i18n="footVrcAvatar">ğŸ‘¤ Public Avatar</span></a>
                        <a id="openVrcWorldLink" href="" class="discrete-link" target="_blank" style="display:none;"><span data-i18n="footVrcWorld">ğŸŒ Public World</span></a>
                        <a id="openBoothLink" href="" class="discrete-link" target="_blank"><span data-i18n="footBooth">ğŸ›’ Booth</span></a>
                        <a id="openFolderLink" href="" class="discrete-link" target="_blank"><span data-i18n="footFolder">ğŸ“‚ Folder</span></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Load local database script -->
    <script src="web_data/database.js"></script>
    <script>
        const l18n = {"languages": {"en": "English", "ja": "æ—¥æœ¬èª", "ko": "í•œêµ­ì–´", "zh-Hans": "ç®€ä½“ä¸­æ–‡", "zh-Hant": "ç¹é«”ä¸­æ–‡", "de": "Deutsch", "nl": "Nederlands", "fr": "FranÃ§ais", "es": "EspaÃ±ol", "pt": "PortuguÃªs"}, "translations": {"en": {"btnDetails": "Details", "labelComp": "Compatible Assets", "labelDesigned": "Designed For", "labelViewRel": "View All", "warnDelisted": "<b>âš ï¸ Delisted Item</b> This asset may no longer be available on Booth.", "navTitle": "Booth Asset Library", "optionsBtn": "Options âš™", "labelLanguage": "Language", "labelSort": "Sort Order", "optId": "Folder ID", "optNew": "Recently Added", "optName": "A-Z Name", "optRel": "Popularity", "optSize": "Storage Size", "labelAdult": "Content Filter", "optAll": "Show Everything", "optHide": "Hide Adult", "optOnly": "Adult Only", "labelWidth": "Card Width", "optBlur": "Disable Blur", "optHideIds": "Hide Asset IDs", "optTranslate": "Show English Titles", "labelBinary": "Local Files", "footBooth": "ğŸ›’ View on Booth", "footFolder": "ğŸ“‚ Open Folder", "footVrcAvatar": "ğŸ‘¤ Public Avatar", "footVrcWorld": "ğŸŒ Public World", "searchPre": "Searching ", "searchSuf": " assets...", "fileSingular": "file", "filePlural": "files", "moreTags": "+ {n} others", "hiddenResults": " ({n} items hidden by filter)", "statItems": "Total Assets", "statSize": "Library Size", "statImgSize": "Graphics Size", "statSpent": "Estimated Investment", "statUpdated": "Last Refreshed", "labelTopTags": "Frequent Tags", "btnDesc": "Description", "matchSingular": "match", "matchPlural": "matches", "labelType": "Item Type", "optTypeAll": "All Items", "optTypeAvatar": "Avatars", "optTypeAsset": "Assets"}, "ja": {"btnDetails": "è©³ç´°", "labelComp": "å¯¾å¿œã‚¢ã‚»ãƒƒãƒˆ", "labelDesigned": "å¯¾å¿œãƒ¢ãƒ‡ãƒ«", "labelViewRel": "ã™ã¹ã¦è¦‹ã‚‹", "warnDelisted": "<b>âš ï¸ å…¬é–‹åœæ­¢</b> ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã¯ç¾åœ¨Boothã§å…¬é–‹ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚", "navTitle": "Boothã‚¢ã‚»ãƒƒãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª", "optionsBtn": "è¨­å®š âš™", "labelLanguage": "è¡¨ç¤ºè¨€èª", "labelSort": "ä¸¦ã³æ›¿ãˆ", "optId": "IDé †", "optNew": "è¿½åŠ æ—¥é †", "optName": "åå‰é †", "optRel": "äººæ°—é †", "optSize": "ã‚µã‚¤ã‚ºé †", "labelAdult": "æˆäººå‘ã‘ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼", "optAll": "ã™ã¹ã¦è¡¨ç¤º", "optHide": "æˆäººå‘ã‘ã‚’éš ã™", "optOnly": "æˆäººå‘ã‘ã®ã¿", "labelWidth": "ã‚«ãƒ¼ãƒ‰ã®å¹…", "optBlur": "ã¼ã‹ã—ã‚’ç„¡åŠ¹åŒ–", "optHideIds": "IDã‚’éè¡¨ç¤º", "optTranslate": "ç¿»è¨³ã•ã‚ŒãŸåå‰ã‚’è¡¨ç¤º", "labelBinary": "æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«", "footBooth": "ğŸ›’ Boothã§è¦‹ã‚‹", "footFolder": "ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã", "footVrcAvatar": "ğŸ‘¤ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ãƒã‚¿ãƒ¼", "footVrcWorld": "ğŸŒ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ¯ãƒ¼ãƒ«ãƒ‰", "searchPre": "æ¤œç´¢ä¸­: ", "searchSuf": " ä»¶", "fileSingular": "ãƒ•ã‚¡ã‚¤ãƒ«", "filePlural": "ãƒ•ã‚¡ã‚¤ãƒ«", "moreTags": "ä»– {n} ä»¶", "hiddenResults": " ({n} ä»¶ãŒéè¡¨ç¤º)", "statItems": "ç·ã‚¢ã‚¤ãƒ†ãƒ æ•°", "statSize": "ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®¹é‡", "statImgSize": "ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹å®¹é‡", "statSpent": "æ¨å®šæ”¯å‡ºåˆè¨ˆ", "statUpdated": "æœ€çµ‚æ›´æ–°", "labelTopTags": "äººæ°—ã®ã‚¿ã‚°", "btnDesc": "å•†å“èª¬æ˜", "matchSingular": "ä¸€è‡´", "matchPlural": "ä¸€è‡´", "labelType": "ã‚¢ã‚¤ãƒ†ãƒ ã®ç¨®é¡", "optTypeAll": "ã™ã¹ã¦è¡¨ç¤º", "optTypeAvatar": "ã‚¢ãƒã‚¿ãƒ¼ã®ã¿", "optTypeAsset": "ã‚¢ã‚»ãƒƒãƒˆã®ã¿"}, "ko": {"btnDetails": "ìƒì„¸ ì •ë³´", "labelComp": "í˜¸í™˜ ì—ì…‹", "labelDesigned": "í˜¸í™˜ ëª¨ë¸", "labelViewRel": "ëª¨ë‘ ë³´ê¸°", "warnDelisted": "<b>âš ï¸ íŒë§¤ ì¤‘ì§€ë¨</b> ì´ ì—ì…‹ì€ í˜„ì¬ Boothì—ì„œ ì œê³µë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "navTitle": "Booth ì—ì…‹ ë¼ì´ë¸ŒëŸ¬ë¦¬", "optionsBtn": "ì„¤ì • âš™", "labelLanguage": "ì–¸ì–´ ì„ íƒ", "labelSort": "ì •ë ¬ ê¸°ì¤€", "optId": "í´ë” ID", "optNew": "ìµœê·¼ ì¶”ê°€ë¨", "optName": "ì´ë¦„ìˆœ", "optRel": "ì¸ê¸°ìˆœ", "optSize": "ìš©ëŸ‰ìˆœ", "labelAdult": "ì„±ì¸ ì½˜í…ì¸  í•„í„°", "optAll": "ëª¨ë‘ ë³´ê¸°", "optHide": "ì„±ì¸ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°", "optOnly": "ì„±ì¸ ì½˜í…ì¸ ë§Œ", "labelWidth": "ì¹´ë“œ ë„ˆë¹„", "optBlur": "ë¸”ëŸ¬ íš¨ê³¼ ë„ê¸°", "optHideIds": "í•­ëª© ID ìˆ¨ê¸°ê¸°", "optTranslate": "ë²ˆì—­ëœ ì œëª© ì‚¬ìš©", "labelBinary": "ë¡œì»¬ íŒŒì¼", "footBooth": "ğŸ›’ Boothì—ì„œ ë³´ê¸°", "footFolder": "ğŸ“‚ í´ë” ì—´ê¸°", "footVrcAvatar": "ğŸ‘¤ í¼ë¸”ë¦­ ì•„ë°”íƒ€", "footVrcWorld": "ğŸŒ í¼ë¸”ë¦­ ì›”ë“œ", "searchPre": "ê²€ìƒ‰ ê²°ê³¼: ", "searchSuf": "ê°œ", "fileSingular": "íŒŒì¼", "filePlural": "íŒŒì¼", "moreTags": "+ {n}ê°œ ë”ë³´ê¸°", "hiddenResults": " ({n}ê°œ í•„í„°ë§ë¨)", "statItems": "ì´ ì—ì…‹ ìˆ˜", "statSize": "ì „ì²´ ìš©ëŸ‰", "statImgSize": "ê·¸ë˜í”½ ìš©ëŸ‰", "statSpent": "ì˜ˆìƒ ì´ ì§€ì¶œ", "statUpdated": "ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸", "labelTopTags": "ê°€ì¥ ë§ì´ ì“°ì¸ íƒœê·¸", "btnDesc": "ì„¤ëª…", "matchSingular": "ë§¤ì¹˜", "matchPlural": "ë§¤ì¹˜", "labelType": "ì•„ì´í…œ íƒ€ì…", "optTypeAll": "ëª¨ë“  ì•„ì´í…œ", "optTypeAvatar": "ì•„ë°”íƒ€", "optTypeAsset": "ì—ì…‹"}, "zh-Hans": {"btnDetails": "è¯¦ç»†ä¿¡æ¯", "labelComp": "å…¼å®¹èµ„æº", "labelDesigned": "è®¾è®¡ç”¨äº", "labelViewRel": "æŸ¥çœ‹å…¨éƒ¨", "warnDelisted": "<b>âš ï¸ å·²ä¸‹æ¶å†…å®¹</b> æ­¤èµ„æºå¯èƒ½å·²åœ¨ Booth åœæ­¢å”®å–ã€‚", "navTitle": "Booth èµ„æºåº“", "optionsBtn": "é€‰é¡¹ âš™", "labelLanguage": "è¯­è¨€è®¾ç½®", "labelSort": "æ’åºæ–¹å¼", "optId": "æ–‡ä»¶å¤¹ ID", "optNew": "æœ€è¿‘æ·»åŠ ", "optName": "åç§°æ’åº", "optRel": "äººæ°”ç›¸å…³", "optSize": "å ç”¨ç©ºé—´", "labelAdult": "æˆäººå†…å®¹è¿‡æ»¤", "optAll": "æ˜¾ç¤ºå…¨éƒ¨å†…å®¹", "optHide": "éšè—æˆäººå†…å®¹", "optOnly": "ä»…æˆäººå†…å®¹", "labelWidth": "å¡ç‰‡æ˜¾ç¤ºå®½åº¦", "optBlur": "ç¦ç”¨æ¨¡ç³Šæ•ˆæœ", "optHideIds": "éšè—èµ„æº ID", "optTranslate": "æ˜¾ç¤ºç¿»è¯‘åç§°", "labelBinary": "æœ¬åœ°æ–‡ä»¶", "footBooth": "ğŸ›’ åœ¨ Booth æ‰“å¼€", "footFolder": "ğŸ“‚ æ‰“å¼€æœ¬åœ°ç›®å½•", "footVrcAvatar": "ğŸ‘¤ å…¬å¼€åŒ–èº«", "footVrcWorld": "ğŸŒ å…¬å¼€ä¸–ç•Œ", "searchPre": "æ­£åœ¨æœç´¢ ", "searchSuf": " ä¸ªèµ„æº...", "fileSingular": "æ–‡ä»¶", "filePlural": "æ–‡ä»¶", "moreTags": "+ {n} ä¸ªå…¶ä»–", "hiddenResults": " ({n} ä¸ªå·²è¢«è¿‡æ»¤)", "statItems": "èµ„æºæ€»æ•°", "statSize": "åº“æ€»å¤§å°", "statImgSize": "å›¾ç‰‡å¤§å°", "statSpent": "é¢„è®¡æ€»æ”¯å‡º", "statUpdated": "æœ€å¾Œæ›´æ–°æ—¶é—´", "labelTopTags": "é«˜é¢‘æ ‡ç­¾", "btnDesc": "èµ„æºæè¿°", "matchSingular": "åŒ¹é…", "matchPlural": "åŒ¹é…", "labelType": "é¡¹ç›®ç±»å‹", "optTypeAll": "å…¨éƒ¨é¡¹ç›®", "optTypeAvatar": "ä»…åŒ–èº«", "optTypeAsset": "ä»…èµ„æº"}, "zh-Hant": {"btnDetails": "è©³ç´°è³‡è¨Š", "labelComp": "ç›¸å®¹è³‡æº", "labelDesigned": "è¨­è¨ˆç”¨æ–¼", "labelViewRel": "æŸ¥çœ‹å…¨éƒ¨", "warnDelisted": "<b>âš ï¸ å·²ä¸‹æ¶å…§å®¹</b> æ­¤è³‡æºå¯èƒ½å·²åœ¨ Booth è²©å”®ã€‚", "navTitle": "Booth è³‡æºåº«", "optionsBtn": "é¸é … âš™", "labelLanguage": "èªè¨€è¨­ç½®", "labelSort": "æ’åºæ–¹å¼", "optId": "è³‡æ–™å¤¾ ID", "optNew": "æœ€è¿‘æ·»åŠ ", "optName": "åç¨±æ’åº", "optRel": "äººæ°£ç›¸é—œ", "optSize": "å ç”¨ç©ºé–“", "labelAdult": "æˆäººå…§å®¹éæ¿¾", "optAll": "é¡¯ç¤ºå…¨éƒ¨å…§å®¹", "optHide": "éš±è—æˆäººå…§å®¹", "optOnly": "åƒ…é™æˆäººå…§å®¹", "labelWidth": "å¡ç‰‡é¡¯ç¤ºå¯¬åº¦", "optBlur": "ç¦ç”¨æ¨¡ç³Šæ•ˆæœ", "optHideIds": "éš±è—è³‡æº ID", "optTranslate": "é¡¯ç¤ºç¿»è­¯åç¨±", "labelBinary": "æœ¬åœ°æª”æ¡ˆ", "footBooth": "ğŸ›’ åœ¨ Booth æ‰“é–‹", "footFolder": "ğŸ“‚ æ‰“é–‹è³‡æ–™å¤¾", "footVrcAvatar": "ğŸ‘¤ å…¬é–‹åŒ–èº«", "footVrcWorld": "ğŸŒ å…¬é–‹ä¸–ç•Œ", "searchPre": "æ­£åœ¨æœå°‹ ", "searchSuf": " å€‹è³‡æº...", "fileSingular": "æª”æ¡ˆ", "filePlural": "æª”æ¡ˆ", "moreTags": "+ {n} å€‹å…¶ä»–", "hiddenResults": " ({n} å€‹å·²è¢«éæ¿¾)", "statItems": "è³‡æºç¸½æ•¸", "statSize": "åº«ç¸½å¤§å°", "statImgSize": "åœ–ç‰‡å¤§å°", "statSpent": "é è¨ˆç¸½æ”¯å‡º", "statUpdated": "æœ€å¾Œæ›´æ–°æ™‚é–“", "labelTopTags": "é«˜é »æ¨™ç±¤", "btnDesc": "è©³ç´°æè¿°", "matchSingular": "åŒ¹é…", "matchPlural": "åŒ¹é…", "labelType": "é …ç›®é¡å‹", "optTypeAll": "å…¨éƒ¨é …ç›®", "optTypeAvatar": "åƒ…é™åŒ–èº«", "optTypeAsset": "åƒ…é™è³‡æº"}, "de": {"btnDetails": "Details", "labelComp": "Passendes ZubehÃ¶r", "labelDesigned": "Entwickelt fÃ¼r", "labelViewRel": "Alle zeigen", "warnDelisted": "<b>âš ï¸ Nicht mehr gelistet</b> Dieses Asset ist mÃ¶glicherweise nicht mehr verfÃ¼gbar.", "navTitle": "Booth Bibliothek", "optionsBtn": "Optionen âš™", "labelLanguage": "Sprache", "labelSort": "Sortierung", "optId": "Ordner ID", "optNew": "Zuletzt hinzugefÃ¼gt", "optName": "Name (A-Z)", "optRel": "Beliebtheit", "optSize": "DateigrÃ¶ÃŸe", "labelAdult": "Filter", "optAll": "Alles zeigen", "optHide": "Nicht jugendfrei ausblenden", "optOnly": "Nur 18+", "labelWidth": "Kartenbreite", "optBlur": "Kein Fokus", "optHideIds": "IDs verbergen", "optTranslate": "Ãœbersetzte Titel", "labelBinary": "Dateien", "footBooth": "ğŸ›’ Auf Booth ansehen", "footFolder": "ğŸ“‚ Ordner Ã¶ffnen", "footVrcAvatar": "ğŸ‘¤ Avatar-Link", "footVrcWorld": "ğŸŒ Welt-Link", "searchPre": "Suche ", "searchSuf": " Artikel...", "fileSingular": "Datei", "filePlural": "Dateien", "moreTags": "+ {n} weitere", "hiddenResults": " ({n} durch Filter versteckt)", "statItems": "Gesamtanzahl", "statSize": "BinÃ¤rgrÃ¶ÃŸe", "statImgSize": "GrafikgrÃ¶ÃŸe", "statSpent": "Voraussichtliche Kosten", "statUpdated": "Aktualisiert", "labelTopTags": "HÃ¤ufige Tags", "btnDesc": "Beschreibung", "matchSingular": "Treffer", "matchPlural": "Treffer", "labelType": "Objekttyp", "optTypeAll": "Alle Objekte", "optTypeAvatar": "Avatare", "optTypeAsset": "Assets"}, "nl": {"btnDetails": "Details", "labelComp": "Compatibele Assets", "labelDesigned": "Ontworpen voor", "labelViewRel": "Toon alles", "warnDelisted": "<b>âš ï¸ Verwijderde Inhoud</b> Dit item is mogelijk nicht langer beschikbaar.", "navTitle": "Booth Bibliotheek", "optionsBtn": "Opties âš™", "labelLanguage": "Taal", "labelSort": "Sorteren", "optId": "ID", "optNew": "Nieuwste eerst", "optName": "Naam", "optRel": "Relevantie", "optSize": "Grootte", "labelAdult": "Filter", "optAll": "Alles tonen", "optHide": "Verberg 18+", "optOnly": "Alleen 18+", "labelWidth": "Breedte", "optBlur": "Geen vervaging", "optHideIds": "ID's verbergen", "optTranslate": "Vertaalde titels", "labelBinary": "Bestanden", "footBooth": "ğŸ›’ Bekijk op Booth", "footFolder": "ğŸ“‚ Map openen", "footVrcAvatar": "ğŸ‘¤ Openbare Avatar", "footVrcWorld": "ğŸŒ Openbare Wereld", "searchPre": "Zoek in ", "searchSuf": " items...", "fileSingular": "bestand", "filePlural": "bestanden", "moreTags": "+ {n} meer", "hiddenResults": " ({n} items verborgen)", "statItems": "Totaal items", "statSize": "Binairgrootte", "statImgSize": "Grafische grootte", "statSpent": "Geschatte investering", "statUpdated": "Laatst vernieuwd", "labelTopTags": "Populaire tags", "btnDesc": "Beschrijving", "matchSingular": "match", "matchPlural": "matches", "labelType": "Itemtype", "optTypeAll": "Alle items", "optTypeAvatar": "Avatars", "optTypeAsset": "Assets"}, "fr": {"btnDetails": "DÃ©tails", "labelComp": "Assets Compatibles", "labelDesigned": "ConÃ§u pour", "labelViewRel": "Tout voir", "warnDelisted": "<b>âš ï¸ Contenu non listÃ©</b> Cet asset n'est probablement plus disponible.", "navTitle": "BibliothÃ¨que Booth", "optionsBtn": "Options âš™", "labelLanguage": "Langue", "labelSort": "Trier par", "optId": "ID du dossier", "optNew": "AjoutÃ©s rÃ©cemment", "optName": "Nom (A-Z)", "optRel": "PopularitÃ©", "optSize": "Taille totale", "labelAdult": "Filtre de contenu", "optAll": "Tout afficher", "optHide": "Masquer Adulte", "optOnly": "Adulte uniquement", "labelWidth": "Largeur des cartes", "optBlur": "DÃ©sactiver le flou", "optHideIds": "Masquer les IDs", "optTranslate": "Titres traduits", "labelBinary": "Fichiers locaux", "footBooth": "ğŸ›’ Voir sur Booth", "footFolder": "ğŸ“‚ Ouvrir le dossier", "footVrcAvatar": "ğŸ‘¤ Avatar Public", "footVrcWorld": "ğŸŒ Monde Public", "searchPre": "Recherche de ", "searchSuf": " items...", "fileSingular": "fichier", "filePlural": "fichiers", "moreTags": "+ {n} de plus", "hiddenResults": " ({n} masquÃ©s par filtre)", "statItems": "Total des assets", "statSize": "Taille binaire", "statImgSize": "Taille images", "statSpent": "Investissement estimÃ©", "statUpdated": "Mis Ã  jour le", "labelTopTags": "Tags frÃ©quents", "btnDesc": "Description", "matchSingular": "correspondance", "matchPlural": "correspondances", "labelType": "Type d'objet", "optTypeAll": "Tous les objets", "optTypeAvatar": "Avatars", "optTypeAsset": "Assets"}, "es": {"btnDetails": "Details", "labelComp": "Activos Compatibles", "labelDesigned": "DiseÃ±ado para", "labelViewRel": "Ver todo", "warnDelisted": "<b>âš ï¸ Item no disponible</b> Es probable que este conteÃºdo ya no estÃ©.", "navTitle": "Biblioteca Booth", "optionsBtn": "Opciones âš™", "labelLanguage": "Idioma", "labelSort": "Ordenar por", "optId": "ID de carpeta", "optNew": "AÃ±adidos recentemente", "optName": "Nombre (A-Z)", "optRel": "Relevancia", "optSize": "TamaÃ±o", "labelAdult": "Filtro de conteÃºdo", "optAll": "Mostrar todo", "optHide": "Ocultar adultos", "optOnly": "Solo adultos", "labelWidth": "Ancho de tarjeta", "optBlur": "Quitar desenfoque", "optHideIds": "Ocultar IDs", "optTranslate": "TÃ­tulos traducidos", "labelBinary": "Archivos locales", "footBooth": "ğŸ›’ Ver en Booth", "footFolder": "ğŸ“‚ Abrir carpeta", "footVrcAvatar": "ğŸ‘¤ Avatar PÃºblico", "footVrcWorld": "ğŸŒ Mundo PÃºblico", "searchPre": "Buscando ", "searchSuf": " activos...", "fileSingular": "archivo", "filePlural": "archivos", "moreTags": "+ {n} otros", "hiddenResults": " ({n} ocultos)", "statItems": "Activos totales", "statSize": "TamaÃ±o binario", "statImgSize": "TamaÃ±o imÃ¡genes", "statSpent": "InversiÃ³n estimada", "statUpdated": "Ãšltima actualizaciÃ³n", "labelTopTags": "Etiquetas comunes", "btnDesc": "DescripciÃ³n", "matchSingular": "coincidencia", "matchPlural": "coincidencias", "labelType": "Tipo de artÃ­culo", "optTypeAll": "Todos los artÃ­culos", "optTypeAvatar": "Avatares", "optTypeAsset": "Activos"}, "pt": {"btnDetails": "Detalhes", "labelComp": "Assets CompatÃ­veis", "labelDesigned": "Projetado para", "labelViewRel": "Ver todos", "warnDelisted": "<b>âš ï¸ ConteÃºdo removido</b> Este asset pode nÃ£o estar mais disponible.", "navTitle": "Biblioteca Booth", "optionsBtn": "OpÃ§Ãµes âš™", "labelLanguage": "Idioma", "labelSort": "Ordenar por", "optId": "ID da pasta", "optNew": "Adicionados recentemente", "optName": "Nombre (A-Z)", "optRel": "Popularidade", "optSize": "Tamanho total", "labelAdult": "Filtre de conteÃºdo", "optAll": "Mostrar tudo", "optHide": "Ocultar 18+", "optOnly": "Apenas 18+", "labelWidth": "Largura dos cards", "optBlur": "Sem desfoque", "optHideIds": "Ocultar IDs", "optTranslate": "TÃ­tulos traducidos", "labelBinary": "Arquivos locais", "footBooth": "ğŸ›’ Ver no Booth", "footFolder": "ğŸ“‚ Abrir pasta", "footVrcAvatar": "ğŸ‘¤ Avatar PÃºblico", "footVrcWorld": "ğŸŒ Mundo PÃºblico", "searchPre": "Pesquisando ", "searchSuf": " itens...", "fileSingular": "arquivo", "filePlural": "arquivos", "moreTags": "+ {n} outros", "hiddenResults": " ({n} itens ocultos)", "statItems": "Total de itens", "statSize": "Tamanho binÃ¡rio", "statImgSize": "Tamanho images", "statSpent": "Investimento estimado", "statUpdated": "Ãšltima actualizaciÃ³n", "labelTopTags": "Tags frequentes", "btnDesc": "DescriÃ§Ã£o", "matchSingular": "correspondÃªncia", "matchPlural": "correspondÃªncias", "labelType": "Tipo de item", "optTypeAll": "Todos os itens", "optTypeAvatar": "Avatares", "optTypeAsset": "Assets"}}};
        const translations = l18n.translations;
        // window.BOOTH_DATABASE is populated by the script above
        const database = window.BOOTH_DATABASE || [];
        
        let currentCarouselIndex = 0, currentImages = [];
        const baseTitle = "Booth Asset Library";
        const getLS = (k, def) => localStorage.getItem(k) || def;
        const state = { gridSize: getLS('gridSize', '220'), disableBlur: getLS('disableBlur', 'false') === 'true', sortOrder: getLS('sortOrder', 'id'), adultFilter: getLS('adultFilter', 'all'), typeFilter: getLS('typeFilter', 'all'), hideIds: getLS('hideIds', 'false') === 'true', lang: getLS('lang', 'en'), showTrans: getLS('showTrans', 'true') === 'true' };
        
        const observerOptions = { root: null, rootMargin: '1000px', threshold: 0.01 };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    const img = el.querySelector('.image-thumbnail');
                    const glow = el.querySelector('.image-backglow');
                    if (img && !img.src) img.src = el.dataset.img;
                    if (glow && !glow.src) glow.src = el.dataset.img;
                    el.classList.add('is-visible');
                    observer.unobserve(el);
                }
            });
        }, observerOptions);

        function init() {
            renderLibrary();
            
            const langSel = document.getElementById('langSelect');
            langSel.innerHTML = "";
            Object.entries(l18n.languages).forEach(([code, name]) => {
                const opt = document.createElement('option');
                opt.value = code; opt.innerText = name;
                langSel.appendChild(opt);
            });

            updateLanguage(state.lang); updateGrid(state.gridSize); updateBlur(state.disableBlur); updateIdVisibility(state.hideIds); updateTranslationVisibility(state.showTrans);
            document.getElementById('gridRange').value = state.gridSize; document.getElementById('blurToggle').checked = state.disableBlur; document.getElementById('sortOrder').value = state.sortOrder;
            document.getElementById('adultFilter').value = state.adultFilter; document.getElementById('typeFilter').value = state.typeFilter; document.getElementById('hideIdToggle').checked = state.hideIds; document.getElementById('translateToggle').checked = state.showTrans;
            
            calculateStats();
            const urlParams = new URLSearchParams(window.location.search);
            const queryParam = urlParams.get('q');
            if (queryParam) document.getElementById("searchInput").value = queryParam;

            handleSearchInput(); sortAssets();
            const targetId = urlParams.get('id');
            if (targetId) openDetails(targetId, true);
            setTimeout(() => { document.body.classList.add('loaded'); }, 50);
        }

        function calculateStats() {
            let totalBinaryBytes = 0, totalImageBytes = 0;
            const tagCounts = {}, spent = {};
            database.forEach(item => {
                totalBinaryBytes += item.bytes;
                totalImageBytes += item.imgBytes;
                item.tags.forEach(t => tagCounts[t] = (tagCounts[t] || 0) + 1);
                if (item.priceValue > 0 && item.priceCurrency) spent[item.priceCurrency] = (spent[item.priceCurrency] || 0) + item.priceValue;
            });
            const topTags = Object.entries(tagCounts).sort((a,b) => b[1] - a[1]).slice(0, 10);
            document.getElementById('commonTags').innerHTML = topTags.map(([tag]) => `<span class="tag-pill clickable" onclick="tagSearch('${tag.replace(/'/g, "\\'")}')">${tag}</span>`).join('');
            document.getElementById('statCount').innerText = database.length;
            document.getElementById('statSize').innerText = formatBytes(totalBinaryBytes);
            document.getElementById('statImgSize').innerText = formatBytes(totalImageBytes);
            document.getElementById('statSpent').innerText = Object.entries(spent).map(([cur, val]) => val.toLocaleString() + " " + cur).join(" / ") || "0";
            document.getElementById('statDate').innerText = new Date().toLocaleDateString();
        }

        function renderLibrary() {
            const list = document.getElementById('assetList');
            list.innerHTML = database.map(item => {
                const isAdult = item.adult ? 'adult-content' : '';
                return `<li class="asset" id="asset-${item.id}" onclick="openDetails('${item.id}')" data-id="${item.id}">
                    <div class="skeleton-shimmer"></div>
                    <div class="image-container"><div class="asset-id-tag">#${item.id}</div><img class="image-thumbnail ${isAdult}" loading="lazy"></div>
                    <img class="image-backglow"><div class="content">
                        <div class="name"><span class="name-primary"></span></div>
                        <div class="author-label">by <b class="author-primary"></b></div>
                        <div class="stats"></div>
                        <div class="tag-row"></div>
                    </div>
                </li>`;
            }).join('');
            database.forEach(item => {
                const el = document.getElementById('asset-' + item.id);
                el.dataset.img = item.gridThumb;
                observer.observe(el);
            });
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024, sizes = ['B', 'KB', 'MB', 'GB', 'TB'], i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function updateLanguage(lang) { 
            state.lang = lang; localStorage.setItem('lang', lang); 
            document.getElementById('langSelect').value = lang; 
            const t = translations[lang] || translations['en']; 
            if (!t) return;
            document.querySelectorAll('[data-i18n]').forEach(el => { el.innerText = t[el.dataset.i18n]; }); 
            document.querySelectorAll('[data-i18n-html]').forEach(el => { el.innerHTML = t[el.dataset.i18nHtml]; });
            applyFilters(); 
        }

        function toggleMenu(e, forceClose = false) { if(e) e.stopPropagation(); const menu = document.getElementById('flyoutMenu'), btn = document.getElementById('toggleBtn'), perim = document.getElementById('menuPerimeter'); const open = !forceClose && !menu.classList.contains('open'); menu.classList.toggle('open', open); btn.classList.toggle('active', open); perim.style.display = open ? 'block' : 'none'; }
        function updateGrid(v) { document.documentElement.style.setProperty('--grid-size', v + 'px'); localStorage.setItem('gridSize', v); }
        function updateBlur(v) { document.body.classList.toggle('no-blur', v); localStorage.setItem('disableBlur', v); }
        function updateIdVisibility(v) { document.body.classList.toggle('hide-ids', v); localStorage.setItem('hideIds', v); }

        function updateTranslationVisibility(v) { 
            state.showTrans = v; localStorage.setItem('showTrans', v);
            const t = translations[state.lang] || translations['en'];
            database.forEach(item => {
                const el = document.getElementById('asset-' + item.id);
                if (!el) return;
                el.querySelector('.name-primary').innerText = (v && item.nameTrans) ? item.nameTrans : item.nameOrig;
                el.querySelector('.author-primary').innerText = (v && item.authorTrans) ? item.authorTrans : item.authorOrig;
                el.querySelector('.tag-row').innerHTML = item.tags.slice(0, 12).map(tg => `<span class="tag-pill">${tg}</span>`).join('');
                
                let statsHtml = item.bytes > 0 ? `<span>${formatBytes(item.bytes)}</span>` : "";
                if (item.fileCount > 0) statsHtml += `<span>${item.fileCount} ${item.fileCount === 1 ? t.fileSingular : t.filePlural}</span>`;
                if (item.links.length > 0) statsHtml += `<span>${item.links.length} ${item.links.length === 1 ? t.matchSingular : t.matchPlural}</span>`;
                el.querySelector('.stats').innerHTML = statsHtml;
            });
            const modal = document.getElementById('detailModal');
            if (modal.classList.contains('active')) {
                const id = new URLSearchParams(window.location.search).get('id');
                const item = database.find(d => d.id === id);
                if (item) document.getElementById('modalDesc').innerHTML = formatDescription((v && item.descTrans) ? item.descTrans : item.descOrig);
            }
        }

        function formatDescription(text) {
            if (!text) return "";
            const urlRegex = /(https?:\/\/[^\s\n]+)/g;
            return text.replace(urlRegex, (url) => `<a href="${url}" target="_blank" onclick="event.stopPropagation()">${url}</a>`);
        }

        function handleSearchInput() { 
            const query = document.getElementById("searchInput").value.toLowerCase();
            const newUrl = new URL(window.location);
            if (query) newUrl.searchParams.set('q', query); else newUrl.searchParams.delete('q');
            window.history.replaceState({}, '', newUrl);
            applyFilters(); 
        }

        function clearSearch() { const i = document.getElementById("searchInput"); i.value = ""; handleSearchInput(); i.focus(); }

        function tagSearch(query, isAuthor = false) {
            const s = document.getElementById("searchInput");
            s.value = isAuthor ? `author:${query}` : query;
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('q', s.value);
            window.history.pushState({}, '', newUrl);
            closeModal();
            handleSearchInput();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function applyFilters(save = false) {
            let query = document.getElementById("searchInput").value.toLowerCase();
            const mode = document.getElementById("adultFilter").value;
            const typeMode = document.getElementById("typeFilter").value;
            const t = translations[state.lang] || translations['en'];
            if(save) { state.adultFilter = mode; state.typeFilter = typeMode; localStorage.setItem('adultFilter', mode); localStorage.setItem('typeFilter', typeMode); }

            let count = 0, hiddenCount = 0;
            const isAuthorSearch = query.startsWith('author:'), isRelSearch = query.startsWith('rel:'), isTypeSearch = query.startsWith('type:');
            const authorQuery = isAuthorSearch ? query.replace('author:', '').trim() : '';
            const relQuery = isRelSearch ? query.replace('rel:', '').trim() : '';
            const typeSearchVal = isTypeSearch ? query.replace('type:', '').trim() : '';

            database.forEach(item => {
                const el = document.getElementById('asset-' + item.id);
                const adultMatch = (mode === 'all') || (mode === 'hide' && !item.adult) || (mode === 'only' && item.adult);
                const typeMatch = (typeMode === 'all') || (typeMode === 'avatar' && item.isAvatar) || (typeMode === 'asset' && !item.isAvatar);
                
                let searchMatch = false;
                if (isRelSearch) searchMatch = (item.id === relQuery) || item.links.includes(relQuery);
                else if (isAuthorSearch) searchMatch = item.authorOrig.toLowerCase().includes(authorQuery) || item.authorTrans.toLowerCase().includes(authorQuery);
                else if (isTypeSearch) searchMatch = (typeSearchVal === 'avatar' ? item.isAvatar : !item.isAvatar);
                else searchMatch = item.searchBlob.includes(query);

                if (searchMatch && adultMatch && typeMatch) { el.style.display = ""; count++; }
                else { el.style.display = "none"; if (searchMatch) hiddenCount++; }
            });

            document.getElementById("searchInput").placeholder = t.searchPre + count + t.searchSuf;
            const notice = document.getElementById("filterNotice");
            if (hiddenCount > 0) { notice.innerText = t.hiddenResults.replace('{n}', hiddenCount).trim(); notice.style.display = "flex"; } else { notice.style.display = "none"; }
        }

        function sortAssets(save = false) {
            const list = document.getElementById('assetList'), order = document.getElementById('sortOrder').value;
            if(save) localStorage.setItem('sortOrder', order);
            const sorted = [...database].sort((a, b) => {
                if (order === 'id') return parseInt(a.id) - parseInt(b.id);
                if (order === 'new') return b.timestamp - a.timestamp;
                if (order === 'rel') return b.wishCount - a.wishCount;
                if (order === 'size') return b.bytes - a.bytes;
                const nA = (state.showTrans && a.nameTrans) ? a.nameTrans : a.nameOrig;
                const nB = (state.showTrans && b.nameTrans) ? b.nameTrans : b.nameOrig;
                return nA.toLowerCase().localeCompare(nB.toLowerCase());
            });
            sorted.forEach(item => list.appendChild(document.getElementById('asset-' + item.id)));
        }

        function openDetails(id, skipHistory = false) {
            const item = database.find(d => d.id === id), t = translations[state.lang] || translations['en'];
            if(!item) return;
            switchTab('details');
            currentImages = item.allImages; currentCarouselIndex = 0; updateCarousel();
            
            const displayTitle = (state.showTrans && item.nameTrans) ? item.nameTrans : item.nameOrig;
            const authorDisp = (state.showTrans && item.authorTrans) ? item.authorTrans : item.authorOrig;
            
            document.getElementById("modalName").innerText = displayTitle;
            document.getElementById("modalSubtitle").innerHTML = `by <a class="modal-author-link" onclick="tagSearch('${item.authorOrig.replace(/'/g, "\\'")}', true)"><b>${authorDisp}</b></a>`;
            
            let metaHtml = (item.nameTrans && state.showTrans) ? `<div class="meta-pill">${item.nameOrig}</div>` : "";
            metaHtml += `<div class="meta-pill">${item.priceCurrency} ${item.priceValue.toLocaleString()}</div>`;
            document.getElementById("modalMeta").innerHTML = metaHtml;
            document.getElementById("modalIdDisp").innerText = "#" + item.id;
            document.getElementById("openFolderLink").href = item.folder;
            document.getElementById("openBoothLink").href = item.boothUrl;
            document.getElementById("delistedWarn").style.display = item.limited ? 'block' : 'none';
            document.getElementById("openVrcAvatarLink").style.display = item.vrcAvatarLink ? "block" : "none";
            document.getElementById("openVrcAvatarLink").href = item.vrcAvatarLink || "";
            document.getElementById("openVrcWorldLink").style.display = item.vrcWorldLink ? "block" : "none";
            document.getElementById("openVrcWorldLink").href = item.vrcWorldLink || "";

            document.getElementById("modalTags").innerHTML = item.tags.map(tg => `<span class="tag-pill clickable" onclick="tagSearch('${tg.replace(/'/g, "\\'")}')">${tg}</span>`).join('');
            document.getElementById("modalDesc").innerHTML = formatDescription((state.showTrans && item.descTrans) ? item.descTrans : item.descOrig);
            document.getElementById("tab-description").style.display = (item.descOrig) ? "block" : "none";

            const relSection = document.getElementById("relSection");
            if (item.links.length > 0) {
                relSection.style.display = "block";
                document.getElementById("relTitle").innerText = item.isAvatar ? t.labelComp : t.labelDesigned;
                let relHtml = item.links.map(linkId => {
                    const target = database.find(d => d.id === linkId);
                    if (!target) return "";
                    const n = (state.showTrans && target.nameTrans) ? target.nameTrans : target.nameOrig;
                    return `<a href="#" class="asset-link-item" onclick="event.preventDefault(); openDetails('${linkId}')">
                        <img class="asset-link-thumb" src="${target.gridThumb}">
                        <span class="asset-link-name">${n}</span>
                    </a>`;
                }).join('') + `<a href="#" class="asset-link-view-all" onclick="event.preventDefault(); tagSearch('rel:${item.id}')"><span>${t.labelViewRel}</span></a>`;
                document.getElementById("relationshipContainer").innerHTML = relHtml;
            } else relSection.style.display = "none";

            document.getElementById("fileList").innerHTML = item.files.sort((a,b) => b.name.localeCompare(a.name, undefined, {numeric:true})).map(f => `
                <li class="file-item"><a class="file-link" href="${f.path}" target="_blank">${f.name}</a><span style="color:#666; font-size:0.7rem;">${f.size}</span></li>`).join('');

            const m = document.getElementById("detailModal"); m.classList.add('visible'); setTimeout(() => m.classList.add('active'), 10);
            document.title = baseTitle + " - #" + id;
            if (!skipHistory) { const newUrl = new URL(window.location); newUrl.searchParams.set('id', id); window.history.pushState({id: id}, '', newUrl); }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-pane, .tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('pane-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }
        function carouselNext(dir) { if (currentImages.length <= 1) return; currentCarouselIndex = (currentCarouselIndex + dir + currentImages.length) % currentImages.length; updateCarousel(); }
        function updateCarousel() {
            const imgUrl = currentImages[currentCarouselIndex], mI = document.getElementById("modalImg"), mB = document.getElementById("modalBlurBg"), dots = document.getElementById("carouselDots");
            mI.src = imgUrl; mB.src = imgUrl;
            if (currentImages.length > 1) { dots.style.display = "flex"; dots.innerHTML = currentImages.map((_, i) => `<div class="dot ${i === currentCarouselIndex ? 'active' : ''}" onclick="currentCarouselIndex=${i}; updateCarousel()"></div>`).join(''); }
            else dots.style.display = "none";
        }
        function closeModal(skipHistory = false) { 
            const m = document.getElementById("detailModal"); m.classList.remove('active'); setTimeout(() => { if(!m.classList.contains('active')) m.classList.remove('visible'); }, 300);
            document.title = baseTitle; if (!skipHistory) { const newUrl = new URL(window.location); newUrl.searchParams.delete('id'); window.history.pushState({}, '', newUrl); }
        }
        window.onpopstate = () => { const p = new URLSearchParams(window.location.search); if (p.get('id')) openDetails(p.get('id'), true); else closeModal(true); };
        document.addEventListener('keydown', e => { if(e.key === "Escape") { closeModal(); toggleMenu(null, true); } if(e.key === "ArrowRight") carouselNext(1); if(e.key === "ArrowLeft") carouselNext(-1); });
        
        // Final init
        init();
    </script>
</body>
</html>
